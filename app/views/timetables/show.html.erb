<div class="container mt-4 mb-4">
  <h1 class="text-center my-4">Timetable for <%= @timetable.start_date %> to <%= @timetable.end_date %></h1>

  <div class="card p-4">
    <table class="table table-bordered table-hover">
      <thead class="thead-dark">
        <tr>
          <th>Meal/Day</th>
          <% (@timetable.start_date..@timetable.end_date).each do |date| %>
            <th><%= date.strftime("%A, %B %d") %></th>
          <% end %>
        </tr>
      </thead>
      <tbody>
        <% %w[breakfast lunch dinner].each do |meal| %>
          <tr>
            <td><%= meal.capitalize %></td>
            <% (@timetable.start_date..@timetable.end_date).each do |date| %>
              <td>
                <p><%= @timetable.send("#{date.strftime("%A").downcase}_#{meal}") %></p>
                <% recipe = @timetable.recipes.find_by(meal_type: "#{date.strftime("%A").downcase}_#{meal}") %>
                <% if recipe %>
                  <p><strong>Ingredients:</strong></p>
                  <ul class="ingredients list-unstyled">
                    <% recipe.ingredients.split(',').each do |ingredient| %>
                      <li><%= ingredient.strip %></li>
                    <% end %>
                  </ul>
                  <p><strong>Steps:</strong></p>
                  <ul class="steps list-unstyled">
                    <% recipe.steps.split('.').each do |step| %>
                      <li><%= step.strip %></li>
                    <% end %>
                  </ul>
                <% else %>
                  <p>No recipe available.</p>
                <% end %>
              </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <div class="text-center my-4">
    <%= link_to 'Edit Timetable', edit_timetable_path(@timetable), class: 'btn btn-primary' %> |
    <%= link_to 'Back to Timetables', timetables_path, class: 'btn btn-secondary' %>
  </div>
</div>
